ipSortingAsTiebreaker
from hosts | sort host desc, card, ip1 desc | limit 8 | keep host, card, ip0, ip1;

 host:keyword  | card:keyword  |                                ip0:ip                                           |                         ip1:ip
gamma          |eth0           |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3                                             
gamma          |lo0            |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9                             
epsilon        |eth0           |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1                             
epsilon        |eth1           |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]                     
epsilon        |eth2           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
beta           |eth0           |127.0.0.1                                                                        |::1                                                   
beta           |eth1           |127.0.0.1                                                                        |128.0.0.1                                             
beta           |eth1           |127.0.0.1                                                                        |127.0.0.2
;

ipSortingByTwoIPs
from hosts | sort ip0, ip1 desc | limit 8 | keep host, card, ip0, ip1;

 host:keyword  | card:keyword  |                                ip0:ip                                           |                         ip1:ip
alpha          |eth1           |::1                                                                              |::1                      
beta           |eth1           |127.0.0.1                                                                        |128.0.0.1                
beta           |eth1           |127.0.0.1                                                                        |127.0.0.2                
alpha          |eth0           |127.0.0.1                                                                        |127.0.0.1                
beta           |eth0           |127.0.0.1                                                                        |::1                      
gamma          |lo0            |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9
epsilon        |eth0           |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1
gamma          |eth0           |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3
;

ipSortingBySameIPfield
from hosts | sort ip0 asc nulls first, ip0 desc, card, host, ip1 | limit 15 | keep host, card, ip0, ip1 | where card != "lo0";

 host:keyword  | card:keyword  |                                ip0:ip                                           |           ip1:ip
epsilon        |eth1           |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]                     
alpha          |eth1           |::1                                                                              |::1                                                   
alpha          |eth0           |127.0.0.1                                                                        |127.0.0.1                                             
beta           |eth0           |127.0.0.1                                                                        |::1                                                   
beta           |eth1           |127.0.0.1                                                                        |127.0.0.2                                             
beta           |eth1           |127.0.0.1                                                                        |128.0.0.1                                             
epsilon        |eth0           |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1                             
gamma          |eth0           |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3                                             
epsilon        |eth2           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

complexMultiSortingFields_SameFieldAscAndDesc
from employees | sort job_positions asc, languages nulls first, gender desc, job_positions desc, emp_no | limit 20 | keep job_positions, languages, gender, emp_no;

                       job_positions:keyword                                |languages:integer|gender:keyword | emp_no:integer    
[Accountant, Internship, Python Developer, Tech Lead]                       |null             |M              |10028          
Accountant                                                                  |null             |M              |10025          
[Accountant, Purchase Manager, Support Engineer]                            |null             |F              |10023          
[Accountant, Business Analyst, Data Scientist, Python Developer]            |1                |M              |10034          
[Accountant, Principal Support Engineer, Support Engineer, Tech Lead]       |1                |F              |10044          
[Accountant, Junior Developer]                                              |1                |F              |10092          
[Accountant, Purchase Manager, Python Developer, Reporting Analyst]         |2                |null           |10016          
[Accountant, Senior Python Developer, Tech Lead]                            |2                |M              |10037          
[Accountant, Junior Developer, Reporting Analyst, Support Engineer]         |2                |M              |10050          
[Accountant, Senior Python Developer]                                       |2                |M              |10001          
[Accountant, Internship]                                                    |2                |M              |10081          
[Accountant, Junior Developer, Principal Support Engineer, Purchase Manager]|3                |M              |10045          
[Accountant, Business Analyst, Purchase Manager]                            |3                |M              |10051          
[Accountant, Junior Developer]                                              |4                |F              |10089          
[Accountant, Head Human Resources]                                          |5                |null           |10012          
[Accountant, Business Analyst, Senior Python Developer, Tech Lead]          |5                |M              |10085          
[Accountant, Data Scientist, Internship, Senior Python Developer]           |5                |M              |10066          
[Accountant, Principal Support Engineer, Senior Python Developer]           |5                |F              |10094          
[Architect, Principal Support Engineer, Purchase Manager, Senior Team Lead] |2                |F              |10059          
[Architect, Internship, Principal Support Engineer]                         |2                |F              |10078 
;

sortingOnMVDoubles
from employees | sort salary_change desc nulls last | limit 10 | keep first_name, last_name, salary_change;

first_name:keyword|last_name:keyword|salary_change:double        
Weiyi             |Meriste          |[-8.94, 1.92, 6.97, 14.74]  
Parto             |Bamford          |[12.82, 14.68]              
Bojan             |Montemayor       |[0.8, 14.63]                
Satosi            |Awdeh            |[-9.81, -1.47, 14.44]       
Tse               |Herber           |[-2.58, -0.95, 14.39]       
Valter            |Sullins          |[-8.78, -3.98, 10.71, 14.26]
Guoxiang          |Nooteboom        |[12.4, 14.25]               
Hironobu          |Haraldson        |[-7.49, 13.97]              
Somnath           |Foote            |13.61                       
Chirstian         |Koblick          |[-0.35, 1.13, 3.65, 13.48]
;

sortingOnMVDoubles_1
from employees | sort salary_change desc nulls last | limit 10 | keep first_name, last_name, salary_change;

first_name:keyword|last_name:keyword|salary_change:double        
Weiyi             |Meriste          |[-8.94, 1.92, 6.97, 14.74]  
Parto             |Bamford          |[12.82, 14.68]              
Bojan             |Montemayor       |[0.8, 14.63]                
Satosi            |Awdeh            |[-9.81, -1.47, 14.44]       
Tse               |Herber           |[-2.58, -0.95, 14.39]       
Valter            |Sullins          |[-8.78, -3.98, 10.71, 14.26]
Guoxiang          |Nooteboom        |[12.4, 14.25]               
Hironobu          |Haraldson        |[-7.49, 13.97]              
Somnath           |Foote            |13.61                       
Chirstian         |Koblick          |[-0.35, 1.13, 3.65, 13.48]
;

sortingOnMVDoubles_2
from employees | sort salary_change asc nulls last | limit 10 | keep first_name, last_name, salary_change;

first_name:keyword|last_name:keyword|salary_change:double        
Satosi            |Awdeh            |[-9.81, -1.47, 14.44]       
Magy              |Stamatiou        |[-9.28, 9.42]               
Amabile           |Gomatam          |[-9.23, 5.19, 5.85, 7.5]    
Weiyi             |Meriste          |[-8.94, 1.92, 6.97, 14.74]  
Valter            |Sullins          |[-8.78, -3.98, 10.71, 14.26]
Udi               |Jansch           |[-8.66, -2.52]              
null              |Swan             |-8.46                       
Otmar             |Herbst           |[-8.19, -1.9, -0.32]        
Danel             |Mondadori        |[-7.88, 9.98, 12.52]        
Mary              |Sluis            |[-7.82, 3.48, 8.73, 10.35]
;

sortingOnNumbersFromStrings
from employees 
| eval long_from_string = to_long(salary_change.keyword) 
| sort long_from_string asc nulls last, emp_no 
| limit 10 
| keep first_name, last_name, salary_change, salary_change.keyword, long_from_string, emp_no;

first_name:keyword|last_name:keyword|salary_change:double        |salary_change.keyword:keyword|long_from_string:long|emp_no:integer     
Satosi            |Awdeh            |[-9.81, -1.47, 14.44]       |[-1.47, -9.81, 14.44]        |[-1, -10, 14]        |10065          
Weiyi             |Meriste          |[-8.94, 1.92, 6.97, 14.74]  |[-8.94, 1.92, 14.74, 6.97]   |[-9, 2, 15, 7]       |10040          
Magy              |Stamatiou        |[-9.28, 9.42]               |[-9.28, 9.42]                |[-9, 9]              |10042          
Udi               |Jansch           |[-8.66, -2.52]              |[-2.52, -8.66]               |[-3, -9]             |10064          
Amabile           |Gomatam          |[-9.23, 5.19, 5.85, 7.5]    |[-9.23, 5.19, 5.85, 7.50]    |[-9, 5, 6, 8]        |10091          
Valter            |Sullins          |[-8.78, -3.98, 10.71, 14.26]|[-3.98, -8.78, 10.71, 14.26] |[-4, -9, 11, 14]     |10099          
Mary              |Sluis            |[-7.82, 3.48, 8.73, 10.35]  |[-7.82, 10.35, 3.48, 8.73]   |[-8, 10, 3, 9]       |10011          
Otmar             |Herbst           |[-8.19, -1.9, -0.32]        |[-0.32, -1.90, -8.19]        |[0, -2, -8]          |10029          
null              |Swan             |-8.46                       |-8.46                        |-8                   |10034          
Sanjiv            |Zschoche         |[-7.67, -3.25]              |[-3.25, -7.67]               |[-3, -8]             |10053
;

sortingOnSwappedFields#[skip:-8.13.3, reason:fixed in 8.13]
FROM employees
| EVAL name = last_name, last_name = first_name, first_name = name
| WHERE first_name > "B" AND last_name IS NOT NULL
| SORT name
| LIMIT 10
| KEEP name, last_name, first_name
;

name:keyword | last_name:keyword | first_name:keyword
Baek         | Premal            | Baek
Bamford      | Parto             | Bamford
Bernatsky    | Mokhtar           | Bernatsky
Bernini      | Brendon           | Bernini
Berztiss     | Yongqiao          | Berztiss
Bierman      | Margareta         | Bierman
Billingsley  | Breannda          | Billingsley
Bouloucos    | Cristinel         | Bouloucos
Brattka      | Charlene          | Brattka
Bridgland    | Patricio          | Bridgland
;

sortingOnSwappedFieldsNoKeep#[skip:-8.13.3, reason:fixed in 8.13]
// Note that this test requires all fields to be returned in order to test a specific code path in physical planning
FROM employees
| EVAL name = first_name, first_name = last_name, last_name = name
| WHERE first_name == "Bernini" AND last_name == "Brendon"
| SORT name
;

avg_worked_seconds:long | birth_date:date      | emp_no:i | gender:k | height:d | height.float:d     | height.half_float:d | height.scaled_float:d | hire_date:date       | is_rehired:bool      | job_positions:k     | languages:i | languages.byte:i | languages.long:l | languages.short:short | salary:i | salary_change:d | salary_change.int:i | salary_change.keyword:k | salary_change.long:l | still_hired:bool | name:k  | first_name:k | last_name:k
349086555               | 1961-09-01T00:00:00Z | 10056    | F        | 1.57     | 1.5700000524520874 | 1.5703125           | 1.57                  | 1990-02-01T00:00:00Z | [false, false, true] | [Senior Team Lead]  | 2           | 2                | 2                | 2                     | 33370    | [-5.17, 10.99]  | [-5, 10]            | [-5.17, 10.99]          | [-5, 10]             | true             | Brendon | Bernini      | Brendon
;

sortingByTsidMetadataField
required_capability: metadata_tsid_field

FROM k8s METADATA _tsid
| SORT network.bytes_in DESC NULLS LAST
| LIMIT 5
| KEEP network.bytes_in, @timestamp, cluster, pod 
;

network.bytes_in:long | @timestamp:datetime      | cluster:keyword | pod:keyword
1021                  | 2024-05-10T00:15:21.000Z | qa              | two
1018                  | 2024-05-10T00:18:33.000Z | prod            | three
1009                  | 2024-05-10T00:20:03.000Z | staging         | two
1007                  | 2024-05-10T00:19:48.000Z | prod            | two
1006                  | 2024-05-10T00:13:50.000Z | qa              | one
;

sortByLimit
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitMultiColumn
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 1 BY languages, gender
| KEEP first_name, last_name, salary, languages, gender
| SORT languages DESC nulls last, gender DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer | gender:keyword
Premal             | Baek              | 52833          | 5                 | M
Arumugam           | Ossenbruggen      | 66817          | 5                 | F
Patricio           | Bridgland         | 48942          | 5                 | null
Mayumi             | Schueller         | 65367          | 4                 | M
Tzvetan            | Zielinski         | 74572          | 4                 | F
Duangkaew          | Piveteau          | 45797          | 4                 | null
Moss               | Shanbhogue        | 74970          | 3                 | M
Erez               | Ritzmann          | 62405          | 3                 | F
Georgi             | Facello           | 57305          | 2                 | M
Valter             | Sullins           | 73578          | 2                 | F
Kazuhito           | Cappelletti       | 61358          | 2                 | null
null               | Merlo             | 70011          | 1                 | M
Sumant             | Peac              | 66174          | 1                 | F
Lillian            | Haddadi           | 73717          | 1                 | null
Otmar              | Herbst            | 74999          | null              | M
Divier             | Reistad           | 73851          | null              | F
;

sortByLimitQualifiedName
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 1 BY [employees].[languages], [employees].[gender]
| KEEP first_name, last_name, salary, languages, gender
| SORT languages DESC nulls last, gender DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer | gender:keyword
Premal             | Baek              | 52833          | 5                 | M
Arumugam           | Ossenbruggen      | 66817          | 5                 | F
Patricio           | Bridgland         | 48942          | 5                 | null
Mayumi             | Schueller         | 65367          | 4                 | M
Tzvetan            | Zielinski         | 74572          | 4                 | F
Duangkaew          | Piveteau          | 45797          | 4                 | null
Moss               | Shanbhogue        | 74970          | 3                 | M
Erez               | Ritzmann          | 62405          | 3                 | F
Georgi             | Facello           | 57305          | 2                 | M
Valter             | Sullins           | 73578          | 2                 | F
Kazuhito           | Cappelletti       | 61358          | 2                 | null
null               | Merlo             | 70011          | 1                 | M
Sumant             | Peac              | 66174          | 1                 | F
Lillian            | Haddadi           | 73717          | 1                 | null
Otmar              | Herbst            | 74999          | null              | M
Divier             | Reistad           | 73851          | null              | F
;

sortByLimitIsIdempotent
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages
| SORT salary DESC
| LIMIT 5 BY languages
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC, first_name, last_name
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitThenSortByLimit
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages
| SORT salary DESC
| LIMIT 1 BY languages
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Tzvetan            | Zielinski         | 74572          | 4
Moss               | Shanbhogue        | 74970          | 3
Valter             | Sullins           | 73578          | 2
Lillian            | Haddadi           | 73717          | 1
Otmar              | Herbst            | 74999          | null
;

sortByLimitZero
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 0 BY languages
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
;

sortLimitThenSortByLimit
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 10
| SORT salary DESC
| LIMIT 1 BY languages
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Tzvetan            | Zielinski         | 74572          | 4
Moss               | Shanbhogue        | 74970          | 3
Valter             | Sullins           | 73578          | 2
Lillian            | Haddadi           | 73717          | 1
Otmar              | Herbst            | 74999          | null
;

sortByLimitThenLimit
required_capability: sort_by_limit

FROM employees
| SORT salary
| LIMIT 5 BY languages
| SORT languages ASC nulls last, salary ASC
| LIMIT 10
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Valdiodio          | Niizuma           | 25976          | 1
Tuval              | Kalloufi          | 28035          | 1
Yishay             | Tzvieli           | 34341          | 1
Vishv              | Zockler           | 39110          | 1
Mingsen            | Casley            | 39728          | 1
Breannda           | Billingsley       | 29175          | 2
Kshitij            | Gils              | 32263          | 2
Brendon            | Bernini           | 33370          | 2
null               | Brender           | 36051          | 2
null               | Makrucki          | 37691          | 2
;

sortByLimitNullsFirst
required_capability: sort_by_limit

FROM employees
| SORT is_rehired ASC NULLS FIRST
| LIMIT 2 BY languages
| SORT languages ASC NULLS FIRST, is_rehired ASC, first_name, last_name
| KEEP first_name, last_name, languages, is_rehired
;

first_name:keyword | last_name:keyword | languages:integer | is_rehired:boolean
Mayuko             | Warwick           | null              | [false, true, true]
Shahaf             | Famili            | null              | [false, true]
Sumant             | Peac              | 1                 | null
Uri                | Lenart            | 1                 | null
Georgi             | Facello           | 2                 | [false, true]
Saniya             | Kalloufi          | 2                 | [false, true]
Anneke             | Preusig           | 3                 | null
Magy               | Stamatiou         | 3                 | null
Parto              | Bamford           | 4                 | null
null               | Lortz             | 4                 | null
Basil              | Tramer            | 5                 | null
Berni              | Genin             | 5                 | null        
;

sortByLimitNullsLast
required_capability: sort_by_limit

FROM employees
| SORT is_rehired ASC NULLS LAST
| LIMIT 2 BY languages
| SORT languages ASC NULLS LAST, is_rehired ASC, first_name, last_name
| KEEP first_name, last_name, languages, is_rehired
;

first_name:keyword | last_name:keyword | languages:integer | is_rehired:boolean
Kyoichi            | Maliniak          | 1                 | [false, false, false, true]
Lillian            | Haddadi           | 1                 | [false, false]
Georgi             | Facello           | 2                 | [false, true]
Saniya             | Kalloufi          | 2                 | [false, true]
null               | Demeyer           | 3                 | [false, false, true]
null               | Reistad           | 3                 | [false, false]
Duangkaew          | Piveteau          | 4                 | [false, false, true, true]
Tzvetan            | Zielinski         | 4                 | [false, false, true, true]
Bezalel            | Simmel            | 5                 | [false, false]
Patricio           | Bridgland         | 5                 | [false, false, true, true]
Mayuko             | Warwick           | null              | [false, true, true]
Shahaf             | Famili            | null              | [false, true]          
;

sortByLimitNoSortAfter
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 1 BY languages
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Otmar              | Herbst            | 74999          | null
Moss               | Shanbhogue        | 74970          | 3
Tzvetan            | Zielinski         | 74572          | 4
Lillian            | Haddadi           | 73717          | 1
Valter             | Sullins           | 73578          | 2
Arumugam           | Ossenbruggen      | 66817          | 5
;

sortByLimitMultiplePerGroupNoSortAfter
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 2 BY languages
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Otmar              | Herbst            | 74999          | null
Moss               | Shanbhogue        | 74970          | 3
Tzvetan            | Zielinski         | 74572          | 4
Divier             | Reistad           | 73851          | null
Lillian            | Haddadi           | 73717          | 1
Valter             | Sullins           | 73578          | 2
Remzi              | Waschkowski       | 71165          | 3
null               | Merlo             | 70011          | 1
Danel              | Mondadori         | 69904          | 2
Hironobu           | Haraldson         | 68431          | 4
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
;

sortByLimitMultiColumnNoSortAfter
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 1 BY languages, gender
| KEEP first_name, last_name, salary, languages, gender
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer | gender:keyword
Otmar              | Herbst            | 74999          | null              | M
Moss               | Shanbhogue        | 74970          | 3                 | M
Tzvetan            | Zielinski         | 74572          | 4                 | F
Divier             | Reistad           | 73851          | null              | F
Lillian            | Haddadi           | 73717          | 1                 | null
Valter             | Sullins           | 73578          | 2                 | F
null               | Merlo             | 70011          | 1                 | M
Arumugam           | Ossenbruggen      | 66817          | 5                 | F
Sumant             | Peac              | 66174          | 1                 | F
Mayumi             | Schueller         | 65367          | 4                 | M
Erez               | Ritzmann          | 62405          | 3                 | F
Kazuhito           | Cappelletti       | 61358          | 2                 | null
Georgi             | Facello           | 57305          | 2                 | M
Premal             | Baek              | 52833          | 5                 | M
Patricio           | Bridgland         | 48942          | 5                 | null
Duangkaew          | Piveteau          | 45797          | 4                 | null
;

sortByLimitByGenderNoSortAfter
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 1 BY gender
| KEEP first_name, last_name, salary, gender
;

first_name:keyword | last_name:keyword | salary:integer | gender:keyword
Otmar              | Herbst            | 74999          | M
Tzvetan            | Zielinski         | 74572          | F
Lillian            | Haddadi           | 73717          | null
;

sortLimitThenSortByLimitNoSortAfter
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 10
| SORT salary DESC
| LIMIT 1 BY languages
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Otmar              | Herbst            | 74999          | null
Moss               | Shanbhogue        | 74970          | 3
Tzvetan            | Zielinski         | 74572          | 4
Lillian            | Haddadi           | 73717          | 1
Valter             | Sullins           | 73578          | 2
;

sortByLimitExpression
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages * 2
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitMixed
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 2 BY languages, gender
| KEEP first_name, last_name, salary, languages, gender
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer | gender:keyword
Arumugam           | Ossenbruggen      | 66817          | 5                 | F
Bezalel            | Simmel            | 56371          | 5                 | F
Premal             | Baek              | 52833          | 5                 | M
Georgy             | Dredge            | 49281          | 5                 | M
Patricio           | Bridgland         | 48942          | 5                 | null
Berni              | Genin             | 37137          | 5                 | null
Tzvetan            | Zielinski         | 74572          | 4                 | F
Hironobu           | Haraldson         | 68431          | 4                 | F
Mayumi             | Schueller         | 65367          | 4                 | M
Parto              | Bamford           | 61805          | 4                 | M
Duangkaew          | Piveteau          | 45797          | 4                 | null
Moss               | Shanbhogue        | 74970          | 3                 | M
Remzi              | Waschkowski       | 71165          | 3                 | M
Erez               | Ritzmann          | 62405          | 3                 | F
null               | Reistad           | 62233          | 3                 | F
Valter             | Sullins           | 73578          | 2                 | F
Danel              | Mondadori         | 69904          | 2                 | F
Kazuhito           | Cappelletti       | 61358          | 2                 | null
Cristinel          | Bouloucos         | 58715          | 2                 | null
Georgi             | Facello           | 57305          | 2                 | M
Claudi             | Stavenow          | 52044          | 2                 | M
Lillian            | Haddadi           | 73717          | 1                 | null
null               | Merlo             | 70011          | 1                 | M
Somnath            | Foote             | 68547          | 1                 | M
Sumant             | Peac              | 66174          | 1                 | F
Uri                | Lenart            | 56415          | 1                 | F
Eberhardt          | Terkki            | 48735          | 1                 | null
Otmar              | Herbst            | 74999          | null              | M
Divier             | Reistad           | 73851          | null              | F
Suzette            | Pettey            | 64675          | null              | F
Ramzi              | Erde              | 60408          | null              | M
;

sortByLimitByConstant
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY 20 * 5, 10
| KEEP first_name, last_name, salary, languages
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Otmar              | Herbst            | 74999          | null
Moss               | Shanbhogue        | 74970          | 3
Tzvetan            | Zielinski         | 74572          | 4
Divier             | Reistad           | 73851          | null
Lillian            | Haddadi           | 73717          | 1
;

sortByLimitMixedFoldableAndAttribute
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages, 42
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitMixedFoldableAndExpression
required_capability: sort_by_limit

FROM employees
| SORT salary DESC
| LIMIT 5 BY languages * 2, 42
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitSeveralSorts
required_capability: sort_by_limit

FROM employees
| SORT emp_no DESC
| SORT salary DESC
| LIMIT 5 BY languages
| KEEP first_name, last_name, salary, languages
| SORT languages DESC nulls last, salary DESC
;

first_name:keyword | last_name:keyword | salary:integer | languages:integer
Arumugam           | Ossenbruggen      | 66817          | 5
Bezalel            | Simmel            | 56371          | 5
Hironoby           | Sidou             | 54518          | 5
Premal             | Baek              | 52833          | 5
Gao                | Dolinsky          | 51956          | 5
Tzvetan            | Zielinski         | 74572          | 4
Hironobu           | Haraldson         | 68431          | 4
Mayumi             | Schueller         | 65367          | 4
Parto              | Bamford           | 61805          | 4
null               | Portugali         | 60781          | 4
Moss               | Shanbhogue        | 74970          | 3
Remzi              | Waschkowski       | 71165          | 3
null               | Demeyer           | 67492          | 3
Anoosh             | Peyn              | 65030          | 3
Erez               | Ritzmann          | 62405          | 3
Valter             | Sullins           | 73578          | 2
Danel              | Mondadori         | 69904          | 2
Kazuhito           | Cappelletti       | 61358          | 2
Cristinel          | Bouloucos         | 58715          | 2
Georgi             | Facello           | 57305          | 2
Lillian            | Haddadi           | 73717          | 1
null               | Merlo             | 70011          | 1
Somnath            | Foote             | 68547          | 1
Sumant             | Peac              | 66174          | 1
Kyoichi            | Maliniak          | 63528          | 1
Otmar              | Herbst            | 74999          | null
Divier             | Reistad           | 73851          | null
Suzette            | Pettey            | 64675          | null
Ramzi              | Erde              | 60408          | null
Shahaf             | Famili            | 48233          | null
;

sortByLimitNonContiguousSorts
required_capability: sort_by_limit

FROM employees
| SORT emp_no DESC
| KEEP emp_no, salary, languages
| SORT salary DESC
| LIMIT 5 BY languages
| KEEP emp_no, salary, languages
| SORT languages DESC nulls last, salary DESC
;

emp_no:integer | salary:integer | languages:integer
10094             | 66817          | 5
10002             | 56371          | 5
10072             | 54518          | 5
10080             | 52833          | 5
10075             | 51956          | 5
10007             | 74572          | 4
10100             | 68431          | 4
10054             | 65367          | 4
10003             | 61805          | 4
10036             | 60781          | 4
10045             | 74970          | 3
10097             | 71165          | 3
10030             | 67492          | 3
10062             | 65030          | 3
10076             | 62405          | 3
10099             | 73578          | 2
10078             | 69904          | 2
10016             | 61358          | 2
10017             | 58715          | 2
10001             | 57305          | 2
10019             | 73717          | 1
10033             | 70011          | 1
10086             | 68547          | 1
10009             | 66174          | 1
10005             | 63528          | 1
10029             | 74999          | null
10027             | 73851          | null
10024             | 64675          | null
10021             | 60408          | null
10022             | 48233          | null
;

sortByLimitEvalAndNonEvalGroupings
required_capability: sort_by_limit

FROM employees
| SORT emp_no DESC
| KEEP emp_no, salary, languages, gender
| SORT salary DESC
| LIMIT 3 BY languages * 2, gender
| SORT languages DESC nulls last, gender DESC nulls last, salary DESC
;

emp_no:integer | salary:integer | languages:integer | gender:keyword
10080          | 52833          | 5                 | M
10055          | 49281          | 5                 | M
10077          | 46595          | 5                 | M
10094          | 66817          | 5                 | F
10002          | 56371          | 5                 | F
10072          | 54518          | 5                 | F
10012          | 48942          | 5                 | null
10014          | 37137          | 5                 | null
10011          | 31120          | 5                 | null
10054          | 65367          | 4                 | M
10003          | 61805          | 4                 | M
10036          | 60781          | 4                 | M
10007          | 74572          | 4                 | F
10100          | 68431          | 4                 | F
10098          | 44817          | 4                 | F
10010          | 45797          | 4                 | null
10045          | 74970          | 3                 | M
10097          | 71165          | 3                 | M
10030          | 67492          | 3                 | M
10076          | 62405          | 3                 | F
10032          | 62233          | 3                 | F
10006          | 60335          | 3                 | F
10001          | 57305          | 2                 | M
10067          | 52044          | 2                 | M
10065          | 50249          | 2                 | M
10099          | 73578          | 2                 | F
10078          | 69904          | 2                 | F
10059          | 44307          | 2                 | F
10016          | 61358          | 2                 | null
10017          | 58715          | 2                 | null
10018          | 56760          | 2                 | null
10033          | 70011          | 1                 | M
10086          | 68547          | 1                 | M
10005          | 63528          | 1                 | M
10009          | 66174          | 1                 | F
10041          | 56415          | 1                 | F
10044          | 39728          | 1                 | F
10019          | 73717          | 1                 | null
10013          | 48735          | 1                 | null
10029          | 74999          | null              | M
10021          | 60408          | null              | M
10022          | 48233          | null              | M
10027          | 73851          | null              | F
10024          | 64675          | null              | F
10023          | 47896          | null              | F
;

sortByLimitMultivalueGroupKeySimple
required_capability: sort_by_limit

ROW x = 1, g = [10, 20, 30]
| SORT x DESC
| LIMIT 1 BY g
| SORT g ASC
| KEEP x, g
;

x:integer | g:integer
1         | 10
1         | 20
1         | 30
;

sortByLimitMultivalueGroupKeySimpleFiltered
required_capability: sort_by_limit

ROW x = 1, g = [10, 20, 30]
| SORT x DESC
| LIMIT 1 BY g
| WHERE g == 20
| KEEP x, g
;

x:integer | g:integer
1         | 20
;

sortByLimitTwoMultivalueGroupKeysSimple
required_capability: sort_by_limit

ROW x = 1, g1 = [1, 2], g2 = [10, 20]
| SORT x DESC
| LIMIT 1 BY g1, g2
| KEEP x, g1, g2
| SORT g1 ASC, g2 ASC
;

x:integer | g1:integer | g2:integer
1         | 1          | 10
1         | 1          | 20
1         | 2          | 10
1         | 2          | 20
;

sortByLimitMultivalueGroupKey
required_capability: sort_by_limit

// 10001 -> [Accountant, Senior Python Developer]
// 10006 -> [Principal Support Engineer, Senior Team Lead, Tech Lead]
// 10002 -> [Senior Team Lead]; loses to 10006 (salary 60335 > 56371)
FROM employees
| WHERE emp_no IN (10001, 10002, 10006)
| SORT salary DESC
| LIMIT 1 BY job_positions
| SORT emp_no, job_positions ASC
| KEEP emp_no, first_name, salary, job_positions
;

emp_no:integer | first_name:keyword | salary:integer | job_positions:keyword
10001          | Georgi             | 57305          | Accountant
10001          | Georgi             | 57305          | Senior Python Developer
10006          | Anneke             | 60335          | Principal Support Engineer
10006          | Anneke             | 60335          | Senior Team Lead
10006          | Anneke             | 60335          | Tech Lead
;

sortByLimitMultivalueGroupKeyFiltered
required_capability: sort_by_limit

FROM employees
| WHERE emp_no IN (10001, 10002, 10006)
| SORT salary DESC
| LIMIT 1 BY job_positions
| WHERE job_positions == "Senior Team Lead"
| KEEP emp_no, first_name, salary, job_positions
;

emp_no:integer | first_name:keyword | salary:integer | job_positions:keyword
10006          | Anneke             | 60335          | Senior Team Lead
;

sortByLimitMultivalueGroupKeyWithCompetition
required_capability: sort_by_limit

FROM employees
| WHERE emp_no IN (10001, 10008)
| SORT salary DESC
| LIMIT 1 BY job_positions
| SORT emp_no, job_positions ASC
| KEEP emp_no, first_name, salary, job_positions
;

emp_no:integer | first_name:keyword | salary:integer | job_positions:keyword
10001          | Georgi             | 57305          | Accountant
10001          | Georgi             | 57305          | Senior Python Developer
10008          | Saniya             | 43906          | Internship
10008          | Saniya             | 43906          | Junior Developer
10008          | Saniya             | 43906          | Purchase Manager
;

sortByLimitMultipleMultivalueGroupKeys
required_capability: sort_by_limit

FROM employees
| WHERE emp_no == 10001
| SORT salary DESC
| LIMIT 1 BY job_positions, is_rehired
| SORT job_positions ASC, is_rehired ASC
| KEEP emp_no, first_name, salary, job_positions, is_rehired
;

emp_no:integer | first_name:keyword | salary:integer | job_positions:keyword   | is_rehired:boolean
10001          | Georgi             | 57305          | Accountant              | false
10001          | Georgi             | 57305          | Accountant              | true
10001          | Georgi             | 57305          | Senior Python Developer | false
10001          | Georgi             | 57305          | Senior Python Developer | true
;

sortByLimitMultivalueGroupKeyLimit2
required_capability: sort_by_limit

FROM employees
| WHERE emp_no IN (10001, 10006, 10008)
| SORT salary DESC
| LIMIT 2 BY job_positions
| SORT job_positions ASC, salary DESC
| KEEP emp_no, first_name, salary, job_positions
;

emp_no:integer | first_name:keyword | salary:integer | job_positions:keyword
10001          | Georgi             | 57305          | Accountant
10008          | Saniya             | 43906          | Internship
10008          | Saniya             | 43906          | Junior Developer
10006          | Anneke             | 60335          | Principal Support Engineer
10008          | Saniya             | 43906          | Purchase Manager
10001          | Georgi             | 57305          | Senior Python Developer
10008          | Saniya             | 43906          | Senior Python Developer
10006          | Anneke             | 60335          | Senior Team Lead
10006          | Anneke             | 60335          | Tech Lead
;
